---
title: "practicaes"
author: "Santi Pérez"
date: "1/5/2022"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r inicilization code}
library(boot)
library(lpSolve)
library(rootSolve)
library(Matrix)
library(calculus)
library(magrittr)

pokemon = read.csv("database.csv")

print("Filtrat pokemon primera generació")
pokemon2 <- pokemon[0:151,0:23]

print("Afegides columnes amb la importància de cada stat en el pokémon")
total = pokemon2$Total
pokemon2["perc_HP"] <- round((pokemon2$HP / total)*100)
pokemon2["perc_Attack"] <- round((pokemon2$Attack / total)*100)
pokemon2["perc_Defense"] <- round((pokemon2$Defense / total)*100)
pokemon2["perc_Sp_Atk"] <- round((pokemon2$Sp_Atk / total)*100)
pokemon2["perc_Sp_Def"] <- round((pokemon2$Sp_Def / total)*100)
pokemon2["perc_Speed"] <- round((pokemon2$Speed / total)*100)

pokemon3 <- pokemon[0:151,5:11]
pokemon3["Number"]       = pokemon2$Number
pokemon3["Pr_Male"]      = pokemon2$Pr_Male
pokemon3["Height_m"]     = pokemon2$Height_m
pokemon3["Weight_kg"]    = pokemon2$Weight_kg
pokemon3["Catch_Rate"]   = pokemon2$Catch_Rate
pokemon3["perc_HP"]      = pokemon2$perc_HP
pokemon3["perc_Attack"]  = pokemon2$perc_Attack
pokemon3["perc_Defense"] = pokemon2$perc_Defense
pokemon3["perc_Sp_Atk"]  = pokemon2$perc_Sp_Atk
pokemon3["perc_Sp_Def"]  = pokemon2$perc_Sp_Def
pokemon3["perc_Speed"]   = pokemon2$perc_Speed
pokemon3

```
Primerament, filtrem la base de dades amb només les columnes i files que necessitem per aquest supòsit.

```{r 1_0 code}
pokemon_1 <- pokemon[0:151,c(6,7,8,9,10,11,22)]
pokemon_1["HP"]     = pokemon2$HP
pokemon_1["Attack"]    = pokemon2$Attack
pokemon_1["Defense"]   = pokemon2$Defense
pokemon_1["Sp_Atk"]      = pokemon2$Sp_Atk
pokemon_1["Sp_Def"]  = pokemon2$Sp_Def
pokemon_1["Speed"] = pokemon2$Speed
pokemon_1["Catch_Rate"]      = pokemon2$Catch_Rate
```

Mostrem la matriu de variàncies i covariàncies de les variables d’aquest supòsit en el següent heatmap per fer-ho més visible.


```{r 1_1 code}
cova=cov(pokemon_1)
cova[is.na(cova)] = 0
heatmap(cova)
```
Observem que la diagonal principal és la que té els valors més alts, ja que hi ha les variàncies. El altres elements són les covariàncies. Fixant-nos amb el Catch_Rate, podem dir que té una variància molt alta (perquè tenim valors entre el 3 i 255), i hi ha poca covariància respecte les altres variables.

Ara, també veurem una matriu (també en format heatmap) que mostra la correlació entre les variables.

```{r 1_2 code}
corr=cor(pokemon_1)
corr[is.na(corr)] = 0
heatmap(corr)
```

La matriu està construïda pels coeficients de correlació de cada parella de variables. Veiem que la diagonal principal és tota d’1s.

Ara, mitjançant l’ANOVA, farem la validació global empleant un model lineal generalitzat.

```{r 1_3 code}
plot(pokemon_1$HP,pokemon_1$Catch_Rate,type = "p", main = "Relació HP amb catch_rate", xlab = "HP", ylab = "Catch_Rate")
print("Gràfica relació atac amb catch_rate")
plot(pokemon_1$Attack,pokemon_1$Catch_Rate,type = "p", main = "Relació atac amb catch_rate", xlab = "Atac", ylab = "Catch_Rate")
print("Gràfica relació defensa amb catch_rate")
plot(pokemon_1$Defense,pokemon_1$Catch_Rate,type = "p", main = "Relació defensa amb catch_rate", xlab = "Defensa", ylab = "Catch Rate")
print("Gràfica relació atac especial amb catch_rate")
plot(pokemon_1$Sp_Atk,pokemon_1$Catch_Rate,type = "p", main = "Relació atac especial amb catch_rate", xlab = "Atac Especial", ylab = "Catch Rate")
print("Gràfica relació defensa especial amb catch_rate")
plot(pokemon_1$Sp_Def,pokemon_1$Catch_Rate,type = "p", main = "Relació defensa especial amb catch_rate", xlab = "Defensa especial", ylab = "Catch Rate")
print("Gràfica relació velocitat amb catch_rate")
plot(pokemon_1$Speed,pokemon_1$Catch_Rate,type = "p", main = "Relació velocitat amb catch_rate", xlab = "Velocitat", ylab = "Catch Rate")
print("Anova")
anova=aov(Catch_Rate~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed,data=pokemon_1)
summary(anova)
print("Model Lineal Generalitzat")
model_1=lm(formula=Catch_Rate~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed, data=pokemon_1)
summary(model_1)
print("acdvdvdv")
aov(model_1)
print("-----")
exp(coef(model_1))
```

Trobem els residuals del model.

```{r 1_4 code}
summary(model_1$residuals)
```
Els primers són els working residuals, i els segons, els deviance residuals

Els intervals de confiança del intercept (Catch_Rate) i de les 6 estadístiques són els següents:

```{r 1_5 code}
confint(model_1)
```

Primer filtrem la base de dades per tal de tenir els pokemon de tipus aigua, foc i planta amb el seu tipus codificat.
```{r 2_0 code}
pokemon4=pokemon[pokemon$Type_1=="Rock" | pokemon$Type_1=="Electric",]
pokemon4$Type_1 = ifelse(pokemon4$Type_1=="Rock",1,0)
pokemon4
pokemon5 <- pokemon4[0:77,c(1,3,6,7,8,9,10,11)]
pokemon5
```


```{r 2_1 code}
#Matriu de variancies i covariancies
cova=cov(pokemon5)
cova[is.na(cova)] = 0
heatmap(cova)
```

```{r 2_2 code}
#Matriu de correlacions
corr=cor(pokemon5)
corr[is.na(corr)] = 0
heatmap(corr)
```
Model i interpretació
```{r 2_3 code}
#He separat els pokemons de tipus aigua i els de tipus normal
#I amb un label encoder he fet que els de tipus Aigua siguin un 1 i els de tipus Normal siguin amb un 0 
print("Grafica Atack")
plot(pokemon4$Attack,pokemon4$Type_1, type = "p", xlab = "Atack", ylab = "Roca=1, Electric=0")
print("Grafica Defense")
plot(pokemon4$Defense,pokemon4$Type_1, type = "p", xlab = "Defense", ylab = "Roca=1, Electric=0")
print("Grafica Spe_Atack")
plot(pokemon4$Sp_Atk,pokemon4$Type_1, type = "p", xlab = "Special Atack", ylab = "Roca=1, Electric=0")
print("Grafica Spe_Atack")
plot(pokemon4$Sp_Def,pokemon4$Type_1, type = "p", xlab = "Special Defense", ylab = "Roca=1, Electric=0")
print("Grafica HP")
plot(pokemon4$HP,pokemon4$Type_1, type = "p", xlab = "HP", ylab = "Roca=1, Electric=0")
print("Grafica Speed")
plot(pokemon4$Speed,pokemon4$Type_1, type = "p", xlab = "Speed", ylab = "Roca=1, Electric=0")

print("Anova")
anova=aov(Type_1~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed,data=pokemon4)
summary(anova)

print("Model Regressió Logística")
modg=glm(Type_1~Attack+Defense+Sp_Atk,family = binomial, data=pokemon4)
summary(modg)
print("acdvdvdv")
aov(modg)
print("-----")
confint(modg)
print("-----")
exp(coef(modg))
print("Model Regressió Poisson")
modg2=glm(Type_1~Attack+Defense+Sp_Atk,family = poisson, data=pokemon4)
summary(modg2)
print("acdvdvdv")
aov(modg2)
print("-----")
confint(modg2)
print("-----")
exp(coef(modg2))

```

Ara farem els intervals de confiança
```{r 2_4 code}

roca=pokemon4[pokemon4$Type_1==1,]
electric=pokemon4[pokemon4$Type_1==0,]

print("Interval de confiança per la diferencia de la mitjana de l'atac")

qqnorm(roca$Attack,pch=19,las=1,main="Roca",xlab = "Quantils teòrics", ylab = "Quantils mostrals")
hist(roca$Attack,las=1,main="Histograma per l'attack dels tipus Roca",xlab="Atac",ylab="Freqüencia")
qqnorm(electric$Attack,pch=19,las=1,main="Electric",xlab = "Quantils teòrics", ylab = "Quantils mostrals")
hist(electric$Attack,las=1,main="Histograma per l'attack dels tipus Electric", xlab="Atac",ylab="Freqüencia")

t.test(x=roca$Attack, y=electric$Attack, paired=FALSE, var.equal=FALSE, conf.level = 0.95)$conf.int

print("Interval de confiança per la diferencia de la mitjana de la defensa")

qqnorm(roca$Defense,pch=19,las=1,main="Roca",xlab = "Quantils teòrics", ylab = "Quantils mostrals")
hist(roca$Defense,las=1,main="Histograma per la defensa dels tipus Roca",xlab="Atac",ylab="Freqüencia")
qqnorm(electric$Defense,pch=19,las=1,main="Electric",xlab = "Quantils teòrics", ylab = "Quantils mostrals")
hist(electric$Defense,las=1,main="Histograma per la defensa dels tipus Electric", xlab="Atac",ylab="Freqüencia")

t.test(x=roca$Defense, y=electric$Defense, paired=FALSE, var.equal=FALSE, conf.level = 0.95)$conf.int

print("Interval de confiança per la diferencia de la mitjana de l'atac especial")

qqnorm(roca$Sp_Atk,pch=19,las=1,main="Roca",xlab = "Quantils teòrics", ylab = "Quantils mostrals")
hist(roca$Sp_Atk,las=1,main="Histograma per l'atac especial dels tipus Roca",xlab="Atac",ylab="Freqüencia")
qqnorm(electric$Sp_Atk,pch=19,las=1,main="Electric",xlab = "Quantils teòrics", ylab = "Quantils mostrals")
hist(electric$Sp_Atk,las=1,main="Histograma per l'atac especial dels tipus Electric", xlab="Atac",ylab="Freqüencia")

t.test(x=roca$Sp_Atk, y=electric$Sp_Atk, paired=FALSE, var.equal=FALSE, conf.level = 0.95)$conf.int


```
