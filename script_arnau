---
title: "practicaes"
author: "Santi Pérez"
date: "1/5/2022"
output: word_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r inicilization code}
library(boot)
library(lpSolve)
library(rootSolve)
library(Matrix)
library(calculus)
library(magrittr)

pokemon = read.csv("database.csv")

print("Filtrat pokemon primera generació")
pokemon2 <- pokemon[0:151,0:23]

print("Afegides columnes amb la importància de cada stat en el pokémon")
total = pokemon2$Total
pokemon2["perc_HP"] <- round((pokemon2$HP / total)*100)
pokemon2["perc_Attack"] <- round((pokemon2$Attack / total)*100)
pokemon2["perc_Defense"] <- round((pokemon2$Defense / total)*100)
pokemon2["perc_Sp_Atk"] <- round((pokemon2$Sp_Atk / total)*100)
pokemon2["perc_Sp_Def"] <- round((pokemon2$Sp_Def / total)*100)
pokemon2["perc_Speed"] <- round((pokemon2$Speed / total)*100)

pokemon3 <- pokemon[0:151,5:11]
pokemon3["Number"]       = pokemon2$Number
pokemon3["Pr_Male"]      = pokemon2$Pr_Male
pokemon3["Height_m"]     = pokemon2$Height_m
pokemon3["Weight_kg"]    = pokemon2$Weight_kg
pokemon3["Catch_Rate"]   = pokemon2$Catch_Rate
pokemon3["perc_HP"]      = pokemon2$perc_HP
pokemon3["perc_Attack"]  = pokemon2$perc_Attack
pokemon3["perc_Defense"] = pokemon2$perc_Defense
pokemon3["perc_Sp_Atk"]  = pokemon2$perc_Sp_Atk
pokemon3["perc_Sp_Def"]  = pokemon2$perc_Sp_Def
pokemon3["perc_Speed"]   = pokemon2$perc_Speed
pokemon3

```
Primerament, filtrem la base de dades amb només les columnes i files que necessitem per aquest supòsit.

```{r 1_0 code}
pokemon_1 <- pokemon[0:151,c(6,7,8,9,10,11,22)]
pokemon_1["HP"]     = pokemon2$HP
pokemon_1["Attack"]    = pokemon2$Attack
pokemon_1["Defense"]   = pokemon2$Defense
pokemon_1["Sp_Atk"]      = pokemon2$Sp_Atk
pokemon_1["Sp_Def"]  = pokemon2$Sp_Def
pokemon_1["Speed"] = pokemon2$Speed
pokemon_1["Catch_Rate"]      = pokemon2$Catch_Rate
```

Mostrem la matriu de variàncies i covariàncies de les variables d’aquest supòsit en el següent heatmap per fer-ho més visible.


```{r 1_1 code}
cova=cov(pokemon_1)
cova[is.na(cova)] = 0
heatmap(cova)
```
Observem que la diagonal principal és la que té els valors més alts, ja que hi ha les variàncies. El altres elements són les covariàncies. Fixant-nos amb el Catch_Rate, podem dir que té una variància molt alta (perquè tenim valors entre el 3 i 255), i hi ha poca covariància respecte les altres variables.

Ara, també veurem una matriu (també en format heatmap) que mostra la correlació entre les variables.

```{r 1_2 code}
corr=cor(pokemon_1)
corr[is.na(corr)] = 0
heatmap(corr)
```

La matriu està construïda pels coeficients de correlació de cada parella de variables. Veiem que la diagonal principal és tota d’1s.

Ara, mitjançant l’ANOVA, farem la validació global empleant un model lineal generalitzat.

```{r 1_3 code}
plot(pokemon_1$HP,pokemon_1$Catch_Rate,type = "p", main = "Relació HP amb catch_rate", xlab = "HP", ylab = "Catch_Rate")
print("Gràfica relació atac amb catch_rate")
plot(pokemon_1$Attack,pokemon_1$Catch_Rate,type = "p", main = "Relació atac amb catch_rate", xlab = "Atac", ylab = "Catch_Rate")
print("Gràfica relació defensa amb catch_rate")
plot(pokemon_1$Defense,pokemon_1$Catch_Rate,type = "p", main = "Relació defensa amb catch_rate", xlab = "Defensa", ylab = "Catch Rate")
print("Gràfica relació atac especial amb catch_rate")
plot(pokemon_1$Sp_Atk,pokemon_1$Catch_Rate,type = "p", main = "Relació atac especial amb catch_rate", xlab = "Atac Especial", ylab = "Catch Rate")
print("Gràfica relació defensa especial amb catch_rate")
plot(pokemon_1$Sp_Def,pokemon_1$Catch_Rate,type = "p", main = "Relació defensa especial amb catch_rate", xlab = "Defensa especial", ylab = "Catch Rate")
print("Gràfica relació velocitat amb catch_rate")
plot(pokemon_1$Speed,pokemon_1$Catch_Rate,type = "p", main = "Relació velocitat amb catch_rate", xlab = "Velocitat", ylab = "Catch Rate")
print("Anova")
anova=aov(Catch_Rate~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed,data=pokemon_1)
summary(anova)
print("Model Lineal Generalitzat")
modg=glm(Catch_Rate~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed,family = poisson, data=pokemon_1)
summary(modg)
print("acdvdvdv")
aov(modg)
print("-----")
confint(modg)
print("-----")
exp(coef(modg))
```

Trobem els residuals. Tant els working residuals com els deviance residuals.

```{r 1_4 code}
summary(modg$residuals)
summary(resid(modg))
```
Els primers són els working residuals, i els segons, els deviance residuals

```{r 2 code}
pokemon4=pokemon2[pokemon2$Type_1=="Water" | pokemon2$Type_1=="Grass" | pokemon2$Type_1=="Fire",]
factors=factor(pokemon4$Type_1)
tipus=as.numeric(factors)
pokemon4["tipus"] = tipus
pokemon4[is.na(pokemon4)]=0
pokemon4

#He separat els pokemons de tipus aigua i els de tipus normal
#I amb un label encoder he fet que els de tipus Aigua siguin un 1 i els de tipus Normal siguin amb un 0 
pokemon4
print("Grafica Atack")
plot(pokemon4$Attack,pokemon4$tipus, type = "p", xlab = "Atack", ylab = "Foc=1, Planta=2, Aigua=3")
print("Grafica Defense")
plot(pokemon4$Defense,pokemon4$tipus, type = "p", xlab = "Defense", ylab = "Foc=1, Planta=2, Aigua=3")
print("Grafica Spe_Atack")
plot(pokemon4$Sp_Atk,pokemon4$tipus, type = "p", xlab = "Special Atack", ylab = "Foc=1, Planta=2, Aigua=3")
print("Grafica Spe_Atack")
plot(pokemon4$Sp_Def,pokemon4$tipus, type = "p", xlab = "Special Defense", ylab = "Foc=1, Planta=2, Aigua=3")
print("Grafica HP")
plot(pokemon4$HP,pokemon4$tipus, type = "p", xlab = "HP", ylab = "Foc=1, Planta=2, Aigua=3")
print("Grafica Speed")
plot(pokemon4$Speed,pokemon4$tipus, type = "p", xlab = "Speed", ylab = "Foc=1, Planta=2, Aigua=3")


print("Anova")
anova=aov(tipus~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed,data=pokemon4)
summary(anova)

print("Model Regressió Logística")
modg=lm(tipus~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed,family = binomial, data=pokemon4)
summary(modg)
print("acdvdvdv")
aov(modg)
print("-----")
confint(modg)
print("-----")
exp(coef(modg))
print("Model Regressió Poisson")
modg2=lm(tipus~HP+Attack+Defense+Sp_Atk+Sp_Def+Speed,family = poisson, data=pokemon4)
summary(modg2)
print("acdvdvdv")
aov(modg2)
print("-----")
confint(modg2)
print("-----")
exp(coef(modg2))

#Matriu variances i covariances
#pokemon5=pokemon3[pokemon2$Type_1=="Water" | pokemon2$Type_1=="Grass" | pokemon2$Type_1=="Fire",]
#cova=cov(pokemon3)
#cova[is.na(cova)] = 0
#heatmap(cova)

```
